<!DOCTYPE html>
<html>
<head>
    <title>BlurN</title>
</head>
<body>
    <div data-role="page" class="page type-interior pluginConfigurationPage BlurNConfigurationPage" data-require="emby-button,emby-input,emby-checkbox">
        <div data-role="content">
            <div class="content-primary">
                <h1 id="BlurNTitle">BlurN</h1>
                <h3>BlurN will retrieve newly released movies on Blu-Ray and add notifications plus a channel listing when a movie matches a number of filters.</h3>
                <form class="BlurNConfigurationForm">
                    <div class="inputContainer" style="display:none;">
                        <input is="emby-input" type="text" id="txtLastPublishDate" label="Last publish date:" disabled="disabled" />
                    </div>
                    <div class="inputContainer">
                        <input is="emby-input" type="text" id="txtAge" label="Maximum age in days:" />
                        <div class="fieldDescription">
                            Number of days elapsed since it was released to cinema. (Default is 730)
                        </div>
                    </div>
                    <div class="inputContainer">
                        <input is="emby-input" type="text" id="txtMinimumIMDBRating" label="Minimum IMDb rating:" />
                        <div class="fieldDescription">
                            Decimal value from 0 to 10. (Default is 6.8)
                        </div>
                    </div>
                    <div class="inputContainer">
                        <input is="emby-input" type="text" id="txtMinimumIMDBVotes" label="Minimum number of IMDb votes:" />
                        <div class="fieldDescription">
                            The more popular the movie the more votes it will tend to get. (Default is 1000)
                        </div>
                    </div>
                    <label class="checkboxContainer">
                        <input is="emby-checkbox" type="checkbox" id="chkUseInterfaceLanguage" />
                        <span>Get movie titles and posters from Emby Server interface language (Default is checked)</span>
                    </label>
                    <label class="checkboxContainer">
                        <input is="emby-checkbox" type="checkbox" id="chkAddItemsAlreadyInLibrary" />
                        <span>Add movies to BlurN even if they already exist in your Emby movie library (Default is checked)</span>
                    </label>
                    <label class="checkboxContainer">
                        <input is="emby-checkbox" type="checkbox" id="chkHidePlayedMovies" />
                        <span>Hide movies from BlurN when they existed in your Emby movie library and have been played (Default is checked)</span>
                    </label>
                    <label class="checkboxContainer">
                        <input is="emby-checkbox" type="checkbox" id="chkDebugLogging" />
                        <span>Enable BlurN debug logging (Default is unchecked)</span>
                    </label>
                    <div>
                        <h3 class="checkboxListLabel">Genre whitelist:</h3>
                        <div class="checkboxList paperList checkboxList-paperList">
                            <div class="fieldDescription">By design, the whitelist matches with the first movie genre. By default all genres are checked. Uncheck the genres you don't want listed.</div>
                            <label>
                                <input type="checkbox" is="emby-checkbox" id="chkAction" />
                                <span>Action</span>
                            </label>
                            <label>
                                <input type="checkbox" is="emby-checkbox" id="chkAdventure" />
                                <span>Adventure</span>
                            </label>
                            <label>
                                <input type="checkbox" is="emby-checkbox" id="chkAnimation" />
                                <span>Animation</span>
                            </label>
                            <label>
                                <input type="checkbox" is="emby-checkbox" id="chkBiography" />
                                <span>Biography</span>
                            </label>
                            <label>
                                <input type="checkbox" is="emby-checkbox" id="chkComedy" />
                                <span>Comedy</span>
                            </label>
                            <label>
                                <input type="checkbox" is="emby-checkbox" id="chkCrime" />
                                <span>Crime</span>
                            </label>
                            <label>
                                <input type="checkbox" is="emby-checkbox" id="chkDrama" />
                                <span>Drama</span>
                            </label>
                            <label>
                                <input type="checkbox" is="emby-checkbox" id="chkFamily" />
                                <span>Family</span>
                            </label>
                            <label>
                                <input type="checkbox" is="emby-checkbox" id="chkFantasy" />
                                <span>Fantasy</span>
                            </label>
                            <label>
                                <input type="checkbox" is="emby-checkbox" id="chkFilmNoir" />
                                <span>Film-Noir</span>
                            </label>
                            <label>
                                <input type="checkbox" is="emby-checkbox" id="chkHistory" />
                                <span>History</span>
                            </label>
                            <label>
                                <input type="checkbox" is="emby-checkbox" id="chkHorror" />
                                <span>Horror</span>
                            </label>
                            <label>
                                <input type="checkbox" is="emby-checkbox" id="chkMusic" />
                                <span>Music</span>
                            </label>
                            <label>
                                <input type="checkbox" is="emby-checkbox" id="chkMusical" />
                                <span>Musical</span>
                            </label>
                            <label>
                                <input type="checkbox" is="emby-checkbox" id="chkMystery" />
                                <span>Mystery</span>
                            </label>
                            <label>
                                <input type="checkbox" is="emby-checkbox" id="chkRomance" />
                                <span>Romance</span>
                            </label>
                            <label>
                                <input type="checkbox" is="emby-checkbox" id="chkSciFi" />
                                <span>Sci-Fi</span>
                            </label>
                            <label>
                                <input type="checkbox" is="emby-checkbox" id="chkSport" />
                                <span>Sport</span>
                            </label>
                            <label>
                                <input type="checkbox" is="emby-checkbox" id="chkThriller" />
                                <span>Thriller</span>
                            </label>
                            <label>
                                <input type="checkbox" is="emby-checkbox" id="chkWar" />
                                <span>War</span>
                            </label>
                            <label>
                                <input type="checkbox" is="emby-checkbox" id="chkWestern" />
                                <span>Western</span>
                            </label>
                        </div>
                    </div>
                    <p>Notifications for new matched releases are enabled/disabled from the <a href="notificationsettings.html">notifications page</a>.</p>
                    <div>
                        <button is="emby-button" type="button" class="raised button-cancel block" id="notificationSettings">
                            <span>Change BlurN notification settings</span>
                        </button>
                    </div>
                    <div>
                        <button is="emby-button" type="button" class="raised button-cancel block" id="resetDatabase">
                            <span>Reset BlurN database</span>
                        </button>
                    </div>
                    <br />
                    <div>
                        <button is="emby-button" type="submit" class="raised button-submit block"><span>Save</span></button>
                    </div>
                    <p><b>Note:</b> This plugin is anonymously tracking its usage purely for statistical purposes.</p>
                    <p>Like my plugin? Buy me a drink!</p>
                    <p><a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=RHMS9UKYKSMM8" target="_blank"><img src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" /></a></p>
                </form>
            </div>
        </div>


        <script type="text/javascript">
            var getHTML = function (url, callback) {

                // Feature detection
                if (!window.XMLHttpRequest) return;

                // Create new request
                var xhr = new XMLHttpRequest();

                // Setup callback
                xhr.onload = function () {
                    if (callback && typeof (callback) === 'function') {
                        callback(this.responseText);
                    }
                }

                // Get the HTML
                xhr.open('GET', url);
                xhr.responseType = 'text';
                xhr.send();

            };
            function showLastPublishedDate(page, date) {
                var d = new Date(date);
                function pad(n) { return n < 10 ? '0' + n : n }
                $('#txtLastPublishDate', page).val(d.getUTCFullYear() + '-'
                + pad(d.getUTCMonth() + 1) + '-'
                + pad(d.getUTCDate()));
            }
            var BlurNConfigurationPage = {
                pluginUniqueId: "08D13692-D214-47DF-B9BD-2868870C5961"
            };
            $('.BlurNConfigurationPage').on('pageinit', function (event) {
                var page = this;
                $('#resetDatabase', page).on('click', function (event) {
                    resetDatabase(page, this.getAttribute('data-id'));
                });
                $('#notificationSettings', page).on('click', function (event) {
                    Dashboard.showLoadingMsg();
                    Dashboard.navigate('notificationsetting.html?type=BlurNNewRelease');
                    Dashboard.hideLoadingMsg();
                });
            });
            $('.BlurNConfigurationPage').on('pageshow', function (event) {
                Dashboard.showLoadingMsg();
                var page = this;
                ApiClient.getPluginConfiguration(BlurNConfigurationPage.pluginUniqueId).then(function (config) {
                    showLastPublishedDate(page, config.LastPublishDate);
                    getHTML('https://raw.githubusercontent.com/MarkCiliaVincenti/MediaBrowser.Channels.BlurN/master/MediaBrowser.Channels.BlurN/latestversion.txt', function (response) {
                        $('#BlurNTitle', page).html('BlurN ' + config.BlurNVersion + ' (latest version <a href="index.html?start=wizard#!/addplugin.html?name=BlurN&guid=08D13692-D214-47DF-B9BD-2868870C5961">' + response + '</a>)');
                    });
                    $('#txtAge', page).val(config.Age || "");
                    $('#txtMinimumIMDBRating', page).val(config.MinimumIMDBRating || "");
                    $('#txtMinimumIMDBVotes', page).val(config.MinimumIMDBVotes || "");
                    $('#chkUseInterfaceLanguage', page).checked(config.UseInterfaceLanguage || false).checkboxradio("refresh");
                    $('#chkAddItemsAlreadyInLibrary', page).checked(config.AddItemsAlreadyInLibrary || false).checkboxradio("refresh");
                    $('#chkHidePlayedMovies', page).checked(config.HidePlayedMovies || false).checkboxradio("refresh");
                    $('#chkDebugLogging', page).checked(config.EnableDebugLogging || false).checkboxradio("refresh");
                    $('#chkAction', page).checked(config.Action || false).checkboxradio("refresh");
                    $('#chkAdventure', page).checked(config.Adventure || false).checkboxradio("refresh");
                    $('#chkAnimation', page).checked(config.Animation || false).checkboxradio("refresh");
                    $('#chkBiography', page).checked(config.Biography || false).checkboxradio("refresh");
                    $('#chkComedy', page).checked(config.Comedy || false).checkboxradio("refresh");
                    $('#chkCrime', page).checked(config.Crime || false).checkboxradio("refresh");
                    $('#chkDrama', page).checked(config.Drama || false).checkboxradio("refresh");
                    $('#chkFamily', page).checked(config.Family || false).checkboxradio("refresh");
                    $('#chkFantasy', page).checked(config.Fantasy || false).checkboxradio("refresh");
                    $('#chkFilmNoir', page).checked(config.FilmNoir || false).checkboxradio("refresh");
                    $('#chkHistory', page).checked(config.History || false).checkboxradio("refresh");
                    $('#chkHorror', page).checked(config.Horror || false).checkboxradio("refresh");
                    $('#chkMusic', page).checked(config.Music || false).checkboxradio("refresh");
                    $('#chkMusical', page).checked(config.Musical || false).checkboxradio("refresh");
                    $('#chkMystery', page).checked(config.Mystery || false).checkboxradio("refresh");
                    $('#chkRomance', page).checked(config.Romance || false).checkboxradio("refresh");
                    $('#chkSciFi', page).checked(config.SciFi || false).checkboxradio("refresh");
                    $('#chkSport', page).checked(config.Sport || false).checkboxradio("refresh");
                    $('#chkThriller', page).checked(config.Thriller || false).checkboxradio("refresh");
                    $('#chkWar', page).checked(config.War || false).checkboxradio("refresh");
                    $('#chkWestern', page).checked(config.Western || false).checkboxradio("refresh");
                    Dashboard.hideLoadingMsg();
                });
            });
            $('.BlurNConfigurationForm').on('submit', function (e) {
                Dashboard.showLoadingMsg();
                var form = this;
                ApiClient.getPluginConfiguration(BlurNConfigurationPage.pluginUniqueId).then(function (config) {
                    config.Age = $('#txtAge', form).val();
                    config.MinimumIMDBRating = $('#txtMinimumIMDBRating', form).val();
                    config.MinimumIMDBVotes = $('#txtMinimumIMDBVotes', form).val();
                    config.UseInterfaceLanguage = $('#chkUseInterfaceLanguage', form).checked();
                    config.AddItemsAlreadyInLibrary = $('#chkAddItemsAlreadyInLibrary', form).checked();
                    config.HidePlayedMovies = $('#chkHidePlayedMovies', form).checked();
                    config.EnableDebugLogging = $('#chkDebugLogging', form).checked();
                    config.Action = $('#chkAction', form).checked();
                    config.Adventure = $('#chkAdventure', form).checked();
                    config.Animation = $('#chkAnimation', form).checked();
                    config.Biography = $('#chkBiography', form).checked();
                    config.Comedy = $('#chkComedy', form).checked();
                    config.Crime = $('#chkCrime', form).checked();
                    config.Drama = $('#chkDrama', form).checked();
                    config.Family = $('#chkFamily', form).checked();
                    config.Fantasy = $('#chkFantasy', form).checked();
                    config.FilmNoir = $('#chkFilmNoir', form).checked();
                    config.History = $('#chkHistory', form).checked();
                    config.Horror = $('#chkHorror', form).checked();
                    config.Music = $('#chkMusic', form).checked();
                    config.Musical = $('#chkMusical', form).checked();
                    config.Mystery = $('#chkMystery', form).checked();
                    config.Romance = $('#chkRomance', form).checked();
                    config.SciFi = $('#chkSciFi', form).checked();
                    config.Sport = $('#chkSport', form).checked();
                    config.Thriller = $('#chkThriller', form).checked();
                    config.War = $('#chkWar', form).checked();
                    config.Western = $('#chkWestern', form).checked();
                    config.DataVersion = "0";
                    ApiClient.updatePluginConfiguration(BlurNConfigurationPage.pluginUniqueId, config).then(Dashboard.processPluginConfigurationUpdateResult);
                });
                // Disable default form submission
                return false;
            });
            function resetDatabase(page, id) {
                Dashboard.confirm('Are you sure you want to reset the BlurN database?', 'Confirm Database Reset', function (result) {
                    if (result) {
                        Dashboard.showLoadingMsg();
                        ApiClient.getPluginConfiguration(BlurNConfigurationPage.pluginUniqueId).then(function (config) {
                            config.LastPublishDate = new Date('2017-01-01T00:00:00.0000000Z');
                            config.DataVersion = "0";

                            ApiClient.updatePluginConfiguration(BlurNConfigurationPage.pluginUniqueId, config).then(function () {
                                showLastPublishedDate(page, config.LastPublishDate);
                                Dashboard.processPluginConfigurationUpdateResult;
                            });
                        });
                        Dashboard.hideLoadingMsg();
                    }
                });
            }
        </script>
    </div>
</body>
</html>